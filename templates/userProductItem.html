{% extends 'index.html' %}

{% block container %}
<article>
    <h3 class="heading-items">Featured Items</h3>
    <p class="tac">Shop for items based on what we featured in this week</p>
    <p class="message">{{message}}</p>
    <div class="box-product">
        {% for product in products %}
        <section class="item-product">
            <a href="/products/showProduct.php?id={{product.id}}" class="product">
                <img class="product-img" src="/{{product.image}}" alt="product_img">
                <div class="product-text">
                    <h5 class="product-name">{{product.name}}</h5>
                    <span class="product-price">$ {{product.price}}</span>
                    <span class="product-comment">☆☆☆☆☆</span>
                </div>
            </a>
            <div class="item-add_top">
                <a href="#" class="item-add_link_top" data-id="{{product.id}}" data-img="{{product.image}}"
                   data-name="{{product.name}}" data-price="{{product.price}}" data-quantity="1">Add to Cart</a>
            </div>
        </section>
        {% endfor %}
    </div>
    <input class="next_page" type="button" name="next_page" value="Next page" data-page="{{page}}">
</article>
{% endblock %}
{% block script %}
<script src="/js/jquery-3.3.1.min.js"></script>
<script>
    $(document).ready(() => {
        //Инициализируем поле для сообщений
        const $message_field = $('.message');
        $('.item-product').on('click', '.item-add_link_top', e => {
            e.preventDefault();
            $.post({
                url: '/api.php',
                data: {
                    apiMethod: 'addToCart',
                    postData: {
                        id: $(e.currentTarget).data('id'),
                        img: $(e.currentTarget).data('img'),
                        name: $(e.currentTarget).data('name'),
                        price: $(e.currentTarget).data('price'),
                        quantity: $(e.currentTarget).data('quantity'),
                    }
                },
                success: function (data) {
                    //data - приходят те данные, которые прислал сервер
                    if (data.data) {
                        $message_field.text(data['data']);
                    }
                    if (data.error) {
                        $message_field.text(data['error_text']);
                    }
                }
            });
        });
        $("article").on('click', '.next_page', e => {
            e.preventDefault();
            $.post({
                url: '/api.php',
                data: {
                    apiMethod: 'nextPage',
                    postData: {
                        page: $(e.currentTarget).data('page'),
                    }
                },
                success: function (data) {
                    if (data.data) {
                        let nextPage = data['data'];
                        window.location.replace("/products/readProducts.php?page=" + nextPage);
                    }
                    if (data.error) {
                        $message_field.text(data['error_text']);
                    }
                }
            });
        });
    });
</script>
{% endblock %}